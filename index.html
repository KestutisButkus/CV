<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CV</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
    <select id="cvSelect" class="form-select form-select-sm" style="width:150px;">
        <option value="cv1.json">CV 1</option>
        <option value="cv2.json">CV 2</option>
        <option value="cv3.json">CV 3</option>
    </select>

    <button id="pdfBtn" class="btn btn-sm btn-primary">PDF</button>
</div>

<!-- CV -->
<div class="cv-container row g-0">

    <!-- LEFT PANEL -->
    <div class="col-md-4 left-panel">
        <div class="text-center">
            <img src="as.png" class="profile-photo" alt="photo">

            <h4 id="vardas" class="vardas"></h4>
            <div id="pareigos" class="pareigos"></div>
        </div>

        <h3>Kontaktai</h3>
        <ul id="kontaktai" class="info-list"></ul>

        <h3>Išsilavinimas</h3>
        <ul id="issilavinimas" class="info-list"></ul>

        <h3>Kalbos</h3>
        <ul id="kalbos" class="info-list"></ul>
    </div>

    <!-- RIGHT PANEL -->
    <div class="col-md-8 right-panel">

        <div class="section-title">Apie mane</div>
        <p id="apie"></p>

        <div class="section-title">Darbo patirtis</div>
        <div id="patirtis"></div>

        <div class="section-title">Įgūdžiai</div>
        <ul id="igudziai" class="skills-list"></ul>

        <div class="section-title">Papildoma</div>
        <ul id="papildoma"></ul>

    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
    function fillCV(data) {
        document.getElementById('vardas').textContent = data.vardas;
        document.getElementById('pareigos').textContent = data.pareigos;

        document.getElementById('kontaktai').innerHTML =
            data.kontaktai.map(x => `<li>${x}</li>`).join('');

        document.getElementById('issilavinimas').innerHTML =
            data.issilavinimas.map(x =>
                `<li><strong>${x.mokykla}</strong><br>${x.metai}<br>${x.sritis}</li>`
            ).join('');

        document.getElementById('kalbos').innerHTML =
            data.kalbos.map(x => `<li>${x}</li>`).join('');

        document.getElementById('igudziai').innerHTML =
            data.igudziai.map(x => `<li>${x}</li>`).join('');

        document.getElementById('apie').textContent = data.apie;

        document.getElementById('patirtis').innerHTML =
            data.patirtis.map(x =>
                `<p><strong>${x.imone}</strong><br>${x.metai}<br>${x.pareigos}</p>`
            ).join('');

        document.getElementById('papildoma').innerHTML =
            data.papildoma.map(x => `<li>${x}</li>`).join('');
    }

    function loadCV(file) {
    fetch(file)
        .then(r => {
            if (!r.ok) throw new Error('Nepavyko įkelti CV');
            return r.json();
        })
        .then(data => fillCV(data))
        .catch(err => console.error('Klaida:', err));
}

    document.getElementById("pdfBtn").onclick = () => {
        const element = document.querySelector(".cv-container");

        const opt = {
            margin: 0,
            filename: 'CV.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save();
    };

    document.getElementById("cvSelect").onchange = (e) => {
        loadCV(e.target.value);
        localStorage.setItem("cvFile", e.target.value);
    };

    const savedCV = localStorage.getItem("cvFile") || "cv1.json";
    document.getElementById("cvSelect").value = savedCV;
    loadCV(savedCV);
</script>

</body>
</html>