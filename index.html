<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CV</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
    <select id="cvSelect" class="form-select form-select-sm py-2" style="width:250px;">
        <option value="cv1">CV1 IT technikas</option>
        <option value="cv2">CV2 Python / Programuotojas</option>
        <option value="cv3">CV3-empty</option>
        <option value="cv3">CV4-empty</option>
    </select>

    <button id="pdfBtn" class="btn btn-sm btn-primary px-4"><strong>PDF</strong></button>
</div>

<!-- CV -->
<div class="cv-container row g-0">

    <!-- LEFT PANEL -->
    <div class="col-md-4 left-panel">
        <div class="text-center">
            <img src="as.png" class="profile-photo" alt="photo">

            <h4 id="vardas" class="vardas"></h4>
            <div id="pareigos" class="pareigos"></div>
        </div>

        <h3>Kontaktai</h3>
        <ul id="kontaktai" class="info-list"></ul>

        <h3>Išsilavinimas</h3>
        <ul id="issilavinimas" class="info-list"></ul>

        <h3>Kalbos</h3>
        <ul id="kalbos" class="info-list"></ul>
    </div>

    <!-- RIGHT PANEL -->
    <div class="col-md-8 right-panel">

        <div class="section-title">Apie mane</div>
        <p id="apie"></p>

        <div class="section-title">Darbo patirtis</div>
        <div id="patirtis"></div>

        <div class="section-title">Įgūdžiai</div>
        <ul id="igudziai" class="skills-list"></ul>

        <div class="section-title">Papildoma</div>
        <ul id="papildoma"></ul>

    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
    function parseCSV(text) {
        return Papa.parse(text, { 
            header: true, 
            skipEmptyLines: true 
        }).data;
    }

    function fillCV(cvName) {
        // Load main info
        fetch(cvName + '_info.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text)[0]; // First row
                document.getElementById('vardas').textContent = data.vardas || '';
                document.getElementById('pareigos').textContent = data.pareigos || '';
                document.getElementById('apie').textContent = data.apie || '';
            })
            .catch(err => console.error('Info klaida:', err));

        // Load contacts
        fetch(cvName + '_kontaktai.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text);

                const regular = data.filter(x => x.tipas === 'tekst');
                const social  = data.filter(x => x.tipas === 'linkedin' || x.tipas === 'github');

                const regularHTML = regular.map(x => `<li>${x.kontaktas || ''}</li>`).join('');

                const socialHTML = social.length ? `
                    <li class="social-icons">
                        ${social.map(x => `
                            <a href="${x.kontaktas || '#'}" target="_blank">
                                <img src="${x.tipas}.png" alt="${x.tipas}" class="social-icon">
                            </a>
                        `).join('')}
                    </li>` : '';

                document.getElementById('kontaktai').innerHTML = regularHTML + socialHTML;
            })
            .catch(err => console.error('Kontaktai klaida:', err));

        // Load education
        fetch(cvName + '_issilavinimas.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text);
                document.getElementById('issilavinimas').innerHTML =
                    data.map(x =>
                        `<li><strong>${x.mokykla || ''}</strong><br>${x.metai || ''}<br>${x.sritis || ''}</li>`
                    ).join('');
            })
            .catch(err => console.error('Išsilavinimas klaida:', err));

        // Load languages
        fetch(cvName + '_kalbos.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text);
                document.getElementById('kalbos').innerHTML =
                    data.map(x => `<li>${x.kalba || ''}</li>`).join('');
            })
            .catch(err => console.error('Kalbos klaida:', err));

        // Load work experience
        fetch(cvName + '_patirtis.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text);
                document.getElementById('patirtis').innerHTML =
                    data.map(x =>
                        `<p><strong>${x.imone || ''}</strong><br>${x.metai || ''}<br>${x.pareigos || ''}</p>`
                    ).join('');
            })
            .catch(err => console.error('Patirtis klaida:', err));

        // Load skills
        fetch(cvName + '_igudziai.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text);
                document.getElementById('igudziai').innerHTML =
                    data.map(x => `<li>${x.igudis || ''}</li>`).join('');
            })
            .catch(err => console.error('Įgūdžiai klaida:', err));

        // Load additional
        fetch(cvName + '_papildoma.csv')
            .then(r => r.text())
            .then(text => {
                const data = parseCSV(text);
                document.getElementById('papildoma').innerHTML =
                    data.map(x => `<li>${x.info || ''}</li>`).join('');
            })
            .catch(err => console.error('Papildoma klaida:', err));
    }

    document.getElementById("pdfBtn").onclick = () => {
        const element = document.querySelector(".cv-container");

        const opt = {
            margin: 0,
            filename: 'CV.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save();
    };

    document.getElementById("cvSelect").onchange = (e) => {
        fillCV(e.target.value);
        localStorage.setItem("cvFile", e.target.value);
    };

    const savedCV = localStorage.getItem("cvFile") || "cv1";
    document.getElementById("cvSelect").value = savedCV;
    fillCV(savedCV);
</script>

</body>
</html>
